---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";

type Props = {
  title: string;
  description: string;
};

const { title, description } = Astro.props;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body>
    <div id="cur"></div>
    <slot />
  </body><script
    data-goatcounter="https://dominickjay.goatcounter.com/count"
    async
    src="//gc.zgo.at/count.js"></script>
  <script is:inline>
    function updateTimeTheme() {
      const now = Temporal.Now.zonedDateTimeISO();
      const hour = now.hour;
      let period = "";

      if (hour >= 5 && hour < 9) period = "early-morning";
      else if (hour >= 9 && hour < 12) period = "late-morning";
      else if (hour >= 12 && hour < 15) period = "early-afternoon";
      else if (hour >= 15 && hour < 17) period = "mid-afternoon";
      else if (hour >= 17 && hour < 19) period = "last-afternoon";
      else if (hour >= 19 && hour < 22) period = "evening";
      else period = "night";

      document.documentElement.setAttribute("data-time", period);
    }

    updateTimeTheme();

    document.addEventListener("mousemove", (e) => {
      const cur = document.getElementById("cur");
      if (cur) {
        cur.style.left = e.clientX + "px";
        cur.style.top = e.clientY + "px";
      }
    });
    document.querySelectorAll(".prose, .body, .intro").forEach((el) => {
      el.addEventListener("mouseenter", () =>
        document.body.classList.add("cur-sm"),
      );
      el.addEventListener("mouseleave", () =>
        document.body.classList.remove("cur-sm"),
      );
    });
    document
      .querySelectorAll("a:not([class]), button, .post-item")
      .forEach((el) => {
        el.addEventListener(
          "mouseenter",
          () => document.body.classList.remove("cur-sm"),
          document.body.classList.add("cur-lg"),
        );
        el.addEventListener(
          "mouseleave",
          () => document.body.classList.add("cur-sm"),
          document.body.classList.remove("cur-lg"),
        );
      });

    // Stagger reveal (per list)
    document.querySelectorAll(".post-list").forEach((postList) => {
      const items = postList.querySelectorAll(".post-item");
      const obs = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (!e.isIntersecting) return;
            const i = [...items].indexOf(e.target);
            setTimeout(() => e.target.classList.add("visible"), i * 26);
            obs.unobserve(e.target);
          });
        },
        { threshold: 0.05 },
      );
      items.forEach((el) => obs.observe(el));
    });
  </script>
</html>
