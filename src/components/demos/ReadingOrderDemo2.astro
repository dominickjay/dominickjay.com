---
import PlaceholderImage from "../PlaceholderImage.astro";
---

<div class="min-w-0 overflow-x-auto">
  <div class="demo-header">
    <p class="eyebrow">Interactive demo · @reading-order</p>
    <h3>Visual order vs DOM order: the gap your users fall into</h3>
    <p class="intro">
      When CSS reorders content visually, keyboard and screen reader users still
      follow the DOM. Use <span style="color: var(--color-dark)">Tab</span> to navigate
      the cards below and feel the difference.
    </p>
  </div>

  <!-- Layout diagram -->
  <p class="slabel" style="margin-bottom: .75rem;">Visual layout</p>
  <div class="layout-diagram" aria-hidden="true">
    <div class="ld-cell ld-cta">
      <span class="name">CTA</span>
      <span class="pos">visual: top-left</span>
    </div>
    <div class="ld-cell ld-feature">
      <span class="name">Feature</span>
      <span class="pos">visual: top-right</span>
    </div>
    <div class="ld-cell ld-arta">
      <span class="name">Article A</span>
      <span class="pos">visual: btm-left</span>
    </div>
    <div class="ld-cell ld-artb">
      <span class="name">Article B</span>
      <span class="pos">visual: btm-right</span>
    </div>
  </div>
  <p style="font-size: 14px; margin-bottom: 2rem;">
    DOM order: Feature(1) · Article A(2) · Article B(3) · CTA(4) — CTA is last
    in the DOM but placed top-left visually.
  </p>

  <!-- Tabs -->
  <div class="tabs" role="tablist">
    <button
      class="tab is-bad active"
      role="tab"
      aria-selected="true"
      aria-controls="panel-bad"
      onclick="show('bad')"
    >
      ❌ Without reading-flow
    </button>
    <button
      class="tab is-good"
      role="tab"
      aria-selected="false"
      aria-controls="panel-good"
      onclick="show('good')"
    >
      ✅ With reading-flow: grid-rows
    </button>
  </div>

  <!-- ═══ BAD PANEL ═══ -->
  <div class="panel panel-bad active" id="panel-bad" role="tabpanel">
    <div class="explainer bad" style="margin-bottom:1.25rem">
      <strong>The problem:</strong> CTA is placed top-left via <code
        >grid-template-areas</code
      >, but it's the <strong>4th item in the DOM</strong>. Tab key ignores grid
      placement entirely — it follows DOM order. A keyboard user hits Feature →
      Article A → Article B → CTA: the opposite of what the layout implies.
    </div>

    <p class="slabel">Live layout — try tabbing through</p>

    <div class="editorial-grid" id="grid-bad">
      <!-- DOM 1st -->
      <article class="cell cell-feature">
        <span class="dom-tag">DOM: 1st</span>
        <span class="cell-label">Feature</span>
        <h2 class="cell-title">
          The hidden cost of visual reordering in modern CSS layouts
        </h2>
        <p class="cell-excerpt">
          Every time we reach for <code>order</code> or <code
            >grid-template-areas</code
          > to move content around the screen, we're making a silent promise to sighted
          users that we may be breaking for everyone else.
        </p>
        <a href="#" class="cell-link" id="bad-feature" onclick="return false"
          >Read feature →</a
        >
      </article>

      <!-- DOM 2nd -->
      <article class="cell cell-art-a">
        <span class="dom-tag">DOM: 2nd</span>
        <span class="cell-label">Article A</span>
        <h2 class="cell-title">WCAG 2.4.3 and the focus order criterion</h2>
        <p class="cell-excerpt">
          Focus order is a Level A requirement, meaning it applies to the
          broadest range of users and content types.
        </p>
        <a href="#" class="cell-link" id="bad-arta" onclick="return false"
          >Read article →</a
        >
      </article>

      <!-- DOM 3rd -->
      <article class="cell cell-art-b">
        <span class="dom-tag">DOM: 3rd</span>
        <span class="cell-label">Article B</span>
        <h2 class="cell-title">
          Testing keyboard navigation: a practical checklist
        </h2>
        <p class="cell-excerpt">
          Tab through your layout. Does focus move in a logical sequence? Does
          it match what a sighted user would expect?
        </p>
        <a href="#" class="cell-link" id="bad-artb" onclick="return false"
          >Read article →</a
        >
      </article>

      <!-- DOM 4th — but visual top-left via grid-area: cta -->
      <article class="cell cell-cta">
        <span class="dom-tag">DOM: 4th ⚠️</span>
        <span class="cell-label">Promoted</span>
        <h2 class="cell-title">New: reading-flow & reading-order</h2>
        <a href="#" class="cell-link" id="bad-cta" onclick="return false"
          >Get started →</a
        >
      </article>
    </div>

    <!-- Focus tracker -->
    <div class="tracker">
      <p class="tracker-label">Tab focus sequence</p>
      <div class="tracker-row">
        <span class="t-step" id="bs-feature">Feature (DOM 1)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="bs-arta">Article A (DOM 2)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="bs-artb">Article B (DOM 3)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="bs-cta">CTA (DOM 4)</span>
      </div>
      <div class="verdict bad">
        ⚠ Focus reaches the CTA last — but it's visually first. A keyboard user
        navigates the grid in a sequence that contradicts what they see. WCAG
        2.4.3 failure.
      </div>
    </div>

    <p class="hint">
      Press <kbd class="key">Tab</kbd> to navigate the grid above and watch the sequence
      light up.
    </p>
  </div>

  <!-- ═══ GOOD PANEL ═══ -->
  <div class="panel panel-good" id="panel-good" role="tabpanel">
    <div class="explainer good" style="margin-bottom:1.25rem">
      <strong>The fix:</strong> Add <code>reading-flow: grid-rows</code> to the container.
      The browser now reads focus order row by row, matching the visual grid — CTA
      → Feature → Article A → Article B. DOM order is unchanged; only focus order
      is corrected.
    </div>

    <p class="slabel">Live layout — try tabbing through</p>

    <div class="editorial-grid grid-solution" id="grid-good">
      <!-- DOM 1st — but reading-flow: grid-rows puts focus on CTA first (top-left) -->
      <article class="cell cell-feature">
        <span class="dom-tag">DOM: 1st</span>
        <span class="cell-label">Feature</span>
        <h2 class="cell-title">
          The hidden cost of visual reordering in modern CSS layouts
        </h2>
        <p class="cell-excerpt">
          Every time we reach for <code>order</code> or <code
            >grid-template-areas</code
          > to move content around the screen, we're making a silent promise to sighted
          users that we may be breaking for everyone else.
        </p>
        <a href="#" class="cell-link" id="good-feature" onclick="return false"
          >Read feature →</a
        >
      </article>

      <article class="cell cell-art-a">
        <span class="dom-tag">DOM: 2nd</span>
        <span class="cell-label">Article A</span>
        <h2 class="cell-title">WCAG 2.4.3 and the focus order criterion</h2>
        <p class="cell-excerpt">
          Focus order is a Level A requirement, meaning it applies to the
          broadest range of users and content types.
        </p>
        <a href="#" class="cell-link" id="good-arta" onclick="return false"
          >Read article →</a
        >
      </article>

      <article class="cell cell-art-b">
        <span class="dom-tag">DOM: 3rd</span>
        <span class="cell-label">Article B</span>
        <h2 class="cell-title">
          Testing keyboard navigation: a practical checklist
        </h2>
        <p class="cell-excerpt">
          Tab through your layout. Does focus move in a logical sequence? Does
          it match what a sighted user would expect?
        </p>
        <a href="#" class="cell-link" id="good-artb" onclick="return false"
          >Read article →</a
        >
      </article>

      <article class="cell cell-cta">
        <span class="dom-tag">DOM: 4th</span>
        <span class="cell-label">Promoted</span>
        <h2 class="cell-title">New: reading-flow & reading-order</h2>
        <a href="#" class="cell-link" id="good-cta" onclick="return false"
          >Get started →</a
        >
      </article>
    </div>

    <!-- Focus tracker -->
    <div class="tracker">
      <p class="tracker-label">Tab focus sequence</p>
      <div class="tracker-row">
        <span class="t-step" id="gs-cta">CTA (visual top-left)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="gs-feature">Feature (visual top-right)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="gs-arta">Article A (visual btm-left)</span>
        <span class="t-arrow">→</span>
        <span class="t-step" id="gs-artb">Article B (visual btm-right)</span>
      </div>
      <div class="verdict good">
        ✓ Focus now moves left-to-right, top-to-bottom — exactly how a sighted
        user reads the grid. DOM order is unchanged; <code>reading-flow</code> corrects
        the accessibility layer only.
      </div>
    </div>

    <div class="hint hint-mobile">
      <button class="play-btn" onclick="playSequence('good')" id="play-good"
        >▶ Simulate focus order</button
      >
    </div>

    <!-- The CSS -->
    <p class="slabel" style="margin-top:1.5rem">The CSS</p>
    <div class="code">
      <span class="c-sel">.editorial-grid</span> &#123;
      <span class="c-prop">display</span>: <span class="c-val">grid</span>;
      <span class="c-prop">grid-template-columns</span>: <span class="c-val"
        >1fr 1fr</span
      >;
      <span class="c-prop">grid-template-areas</span>:
      <span class="c-area">"cta feature"</span>
      <span class="c-area">"art-a art-b"</span>;
      <span class="c-new">reading-flow</span>: <span class="c-new"
        >grid-rows</span
      >; <span class="c-comment">/* ← one line fixes it */</span>
      &#125;

      <span class="c-comment"
        >/* DOM order: feature · art-a · art-b · cta */</span
      >
      <span class="c-comment"
        >/* Focus order after fix: cta → feature → art-a → art-b */</span
      >

      <span class="c-sel">.cell-feature</span> &#123; <span class="c-prop"
        >grid-area</span
      >: <span class="c-area">feature</span>; &#125;
      <span class="c-sel">.cell-art-a</span> &#123; <span class="c-prop"
        >grid-area</span
      >: <span class="c-area">art-a</span>; &#125;
      <span class="c-sel">.cell-art-b</span> &#123; <span class="c-prop"
        >grid-area</span
      >: <span class="c-area">art-b</span>; &#125;
      <span class="c-sel">.cell-cta</span> &#123; <span class="c-prop"
        >grid-area</span
      >: <span class="c-area">cta</span>; &#125; <span class="c-comment"
        >/* DOM: last, visual: top-left */</span
      >
    </div>

    <!-- Order map -->
    <p class="slabel">How the orders map</p>
    <div class="map-grid">
      <div class="mh">Cell</div>
      <div class="mh">DOM position</div>
      <div class="mh">Visual position</div>
      <div class="mh">Focus position</div>

      <div class="mc">CTA</div>
      <div class="mc"><span class="t-dom">4th</span></div>
      <div class="mc"><span class="t-vis">top-left</span></div>
      <div class="mc"><span class="t-fix">1st ✓</span></div>

      <div class="mc">Feature</div>
      <div class="mc"><span class="t-dom">1st</span></div>
      <div class="mc"><span class="t-vis">top-right</span></div>
      <div class="mc"><span class="t-fix">2nd ✓</span></div>

      <div class="mc">Article A</div>
      <div class="mc"><span class="t-dom">2nd</span></div>
      <div class="mc"><span class="t-vis">btm-left</span></div>
      <div class="mc"><span class="t-fix">3rd ✓</span></div>

      <div class="mc">Article B</div>
      <div class="mc"><span class="t-dom">3rd</span></div>
      <div class="mc"><span class="t-vis">btm-right</span></div>
      <div class="mc"><span class="t-fix">4th ✓</span></div>
    </div>
  </div><!-- /good panel -->
</div>

<script>
  // ── Tab switching ──────────────────────────────────────────────────────────
  function show(which) {
    document.querySelectorAll(".tab").forEach((t) => {
      const match = t.classList.contains("is-" + which);
      t.classList.toggle("active", match);
      t.setAttribute("aria-selected", match ? "true" : "false");
    });
    document.querySelectorAll(".panel").forEach((p) => {
      p.classList.toggle("active", p.id === "panel-" + which);
    });
    // Move focus to the first card link so tab flows through the demo
    const firstLink = document.querySelector("#panel-" + which + " .cell-link");
    if (firstLink) firstLink.focus();
  }
  window.show = show;

  // ── Focus tracker ─────────────────────────────────────────────────────────
  const focusMap = {
    "bad-feature": "bs-feature",
    "bad-arta": "bs-arta",
    "bad-artb": "bs-artb",
    "bad-cta": "bs-cta",
    "good-cta": "gs-cta",
    "good-feature": "gs-feature",
    "good-arta": "gs-arta",
    "good-artb": "gs-artb",
  };

  document.querySelectorAll(".cell-link").forEach((link) => {
    link.addEventListener("focus", () => {
      const stepId = focusMap[link.id];
      if (!stepId) return;

      const isBad = link.id.startsWith("bad-");
      const panel = isBad ? "bad" : "good";
      const litClass = isBad ? "lit-bad" : "lit-good";

      // Reset all steps in this panel
      document.querySelectorAll(`#panel-${panel} .t-step`).forEach((s) => {
        s.classList.remove(litClass, "done");
      });

      // Mark previous steps as done, current as lit
      const allSteps = [
        ...document.querySelectorAll(`#panel-${panel} .t-step`),
      ];
      const activeEl = document.getElementById(stepId);
      const activeIdx = allSteps.indexOf(activeEl);

      allSteps.forEach((s, i) => {
        if (i < activeIdx) s.classList.add("done");
        if (i === activeIdx) s.classList.add(litClass);
      });
    });
  });
  const gridSequences = {
    bad: [
      { cell: "#grid-bad .cell-feature", step: "bs-feature", n: 1 },
      { cell: "#grid-bad .cell-art-a", step: "bs-arta", n: 2 },
      { cell: "#grid-bad .cell-art-b", step: "bs-artb", n: 3 },
      { cell: "#grid-bad .cell-cta", step: "bs-cta", n: 4 },
    ],
    good: [
      { cell: "#grid-good .cell-cta", step: "gs-cta", n: 1 },
      { cell: "#grid-good .cell-feature", step: "gs-feature", n: 2 },
      { cell: "#grid-good .cell-art-a", step: "gs-arta", n: 3 },
      { cell: "#grid-good .cell-art-b", step: "gs-artb", n: 4 },
    ],
  };

  function playSequence(panel) {
    const steps = gridSequences[panel];
    if (!steps?.length) return;
    const btn = document.getElementById("play-" + panel);
    const isBad = panel === "bad";
    const color = isBad ? "var(--accent)" : "var(--good)";
    const litClass = isBad ? "lit-bad" : "lit-good";
    const STEP_MS = 900;

    if (btn) {
      btn.disabled = true;
      btn.textContent = "▶ Playing…";
    }

    // Reset tracker
    document.querySelectorAll(`#panel-${panel} .t-step`).forEach((s) => {
      s.classList.remove(litClass, "done");
    });
    // Reset cells
    steps.forEach(({ cell }) => {
      const el = document.querySelector(cell);
      if (!el) return;
      el.classList.remove("playing");
      el.style.removeProperty("--playing-color");
      const badge = el.querySelector(".play-badge");
      if (badge) badge.textContent = "";
    });

    steps.forEach(({ cell, step, n }, i) => {
      setTimeout(() => {
        // Clear previous
        if (i > 0) {
          const prev = document.querySelector(steps[i - 1].cell);
          if (prev) {
            prev.classList.remove("playing");
            const pb = prev.querySelector(".play-badge");
            if (pb) pb.textContent = "";
          }
          const prevStep = document.getElementById(steps[i - 1].step);
          if (prevStep) prevStep.classList.add("done");
        }

        // Activate current
        const el = document.querySelector(cell);
        if (el) {
          el.style.setProperty(
            "--playing-color",
            isBad ? "#b94a38" : "#2c5364",
          );
          el.classList.add("playing");
          const badge = el.querySelector(".play-badge");
          if (badge) {
            badge.textContent = n;
            badge.style.background = isBad ? "#b94a38" : "#2c5364";
          }
          el.scrollIntoView({ behavior: "smooth", block: "nearest" });
        }

        const stepEl = document.getElementById(step);
        if (stepEl) stepEl.classList.add(litClass);
      }, i * STEP_MS);
    });

    // Clean up
    setTimeout(
      () => {
        const last = document.querySelector(steps[steps.length - 1].cell);
        if (last) {
          last.classList.remove("playing");
          const badge = last.querySelector(".play-badge");
          if (badge) badge.textContent = "";
        }
        if (btn) {
          btn.disabled = false;
          btn.textContent = "▶ Simulate focus order";
        }
      },
      steps.length * STEP_MS + 600,
    );
  }
  window.playSequence = playSequence;
</script>

<style>
  :root {
    --bg: #fbf8ef;
    --surface: #f0ece0;
    --surface-2: #e8e3d5;
    --border: #d4cfc0;
    --text: #222222;
    --text-dim: #6b6659;
    --accent: #b94a38;
    --good: #2c5364;
    --mono: "DM Mono", ui-monospace, monospace;
    --serif: "Tiempos", Georgia, serif;
    --r: 8px;
  }
  /* ── Header ── */
  .demo-header {
    padding-block-end: 32px;
  }

  .eyebrow {
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 0.6rem;
  }

  h1 {
    font-family: var(--serif);
    font-size: clamp(1.5rem, 3.5vw, 2.2rem);
    font-weight: 300;
    line-height: 1.2;
    margin-bottom: 0.75rem;
  }

  h1 em {
    font-style: italic;
    color: var(--text-dim);
  }

  .intro {
    font-size: 13px;
    color: var(--text-dim);
    max-width: 540px;
    line-height: 1.7;
  }

  /* ── Tabs ── */
  .tabs {
    display: flex;
    gap: 2px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-bottom: none;
    border-radius: var(--r) var(--r) 0 0;
    padding: 6px 6px 0;
  }

  .tab {
    font-family: var(--mono);
    font-size: 12px;
    padding: 8px 16px;
    background: transparent;
    border: none;
    color: var(--text-dim);
    cursor: pointer;
    border-radius: 4px 4px 0 0;
    transition:
      color 0.15s,
      background 0.15s;
    letter-spacing: 0.03em;
  }

  .tab:hover {
    color: var(--text);
    background: var(--surface-2);
  }
  .tab.active {
    color: var(--text);
    background: var(--bg);
  }
  .tab.active.is-bad {
    color: var(--accent);
  }
  .tab.active.is-good {
    color: var(--good);
  }

  /* ── Panel ── */
  .panel {
    display: none;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 0 var(--r) var(--r) var(--r);
    padding: 1.5rem;
  }

  .panel.active {
    display: block;
  }

  /* ── Section label ── */
  .slabel {
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .slabel::after {
    content: "";
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* ── THE GRID ── */

  /*
      DOM order: feature(1) · article-a(2) · article-b(3) · cta(4)

      Visual layout:
      ┌──────────┬──────────┐
      │  CTA     │ feature  │
      ├──────┬───┴──────────┤
      │ art-a│   art-b      │
      └──────┴──────────────┘
    */

  .editorial-grid {
    display: grid;
    gap: 1px;
    background: var(--border); /* gap colour via bg trick */
    border: 1px solid var(--border);
    border-radius: var(--r);
    overflow: hidden;
    margin-bottom: 1.5rem;

    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    grid-template-areas:
      "cta     feature"
      "art-a   art-b";
  }

  @media (max-width: 520px) {
    .editorial-grid {
      grid-template-columns: 1fr;
      grid-template-areas:
        "cta"
        "feature"
        "art-a"
        "art-b";
    }
  }

  /* Grid area assignments */
  .cell-feature {
    grid-area: feature;
  }
  .cell-art-a {
    grid-area: art-a;
  }
  .cell-art-b {
    grid-area: art-b;
  }
  .cell-cta {
    grid-area: cta;
  }

  /* reading-flow on the solution grid */
  .grid-solution {
    reading-flow: grid-rows;
  }

  /* ── Cell base ── */
  .cell {
    background: var(--surface);
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    position: relative;
    min-height: 130px;
  }

  .cell-feature {
    min-height: 200px;
  }

  .dom-tag {
    display: inline-block;
    font-size: 10px;
    letter-spacing: 0.05em;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text-dim);
    padding: 2px 8px;
    border-radius: 20px;
    align-self: flex-start;
    margin-bottom: 0.25rem;
  }

  .cell-label {
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-dim);
  }

  .cell-title {
    font-family: var(--serif);
    font-weight: 300;
    line-height: 1.25;
    color: var(--text);
  }

  .cell-feature .cell-title {
    font-size: clamp(1rem, 2.5vw, 1.3rem);
  }
  .cell-art-a .cell-title,
  .cell-art-b .cell-title {
    font-size: 0.95rem;
  }
  .cell-cta .cell-title {
    font-size: 0.9rem;
    font-style: italic;
  }

  .cell-excerpt {
    font-size: 12px;
    color: var(--text-dim);
    line-height: 1.6;
    -webkit-line-clamp: 3;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cell-link {
    margin-top: auto;
    align-self: flex-start;
    font-family: var(--mono);
    font-size: 11px;
    padding: 5px 12px;
    border-radius: 4px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text);
    text-decoration: none;
    cursor: pointer;
    transition:
      border-color 0.15s,
      background 0.15s;
  }

  .cell-link:hover {
    background: var(--border);
  }
  .cell-link:focus {
    outline: none;
  }

  /* Focus rings — orange for broken, green for fixed */
  .panel-bad .cell-link:focus-visible {
    box-shadow:
      0 0 0 2px var(--bg),
      0 0 0 4px rgba(185, 74, 56, 0.5);
    border-color: var(--accent);
  }

  .panel-good .cell-link:focus-visible {
    box-shadow:
      0 0 0 2px var(--bg),
      0 0 0 4px rgba(44, 83, 100, 0.5);
    border-color: var(--good);
  }

  /* CTA cell accent */
  .cell-cta {
    background: #161616;
    border-left: 3px solid var(--border);
  }

  .panel-bad .cell-cta {
    border-color: var(--accent);
  }
  .panel-good .cell-cta {
    border-color: var(--good);
  }

  .cell-cta .cell-link {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }

  .panel-good .cell-cta .cell-link {
    background: var(--good);
    border-color: var(--good);
    color: #fff;
  }

  .cell-cta .cell-link:hover {
    opacity: 0.9;
  }

  /* Feature cell accent stripe */
  .cell-feature::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--surface-2), transparent);
  }

  /* ── Explainer ── */
  .explainer {
    font-size: 12px;
    line-height: 1.7;
    color: var(--text-dim);
    background: var(--surface);
    border-left: 3px solid var(--border);
    border-radius: 0 var(--r) var(--r) 0;
    padding: 0.875rem 1rem;
    margin-bottom: 1.5rem;
  }

  .explainer.bad {
    border-color: var(--accent);
  }
  .explainer.good {
    border-color: var(--good);
  }
  .explainer strong {
    color: var(--text);
    font-weight: 500;
  }
  .explainer code {
    font-size: 11px;
    color: var(--text);
  }

  /* ── Focus tracker ── */
  .tracker {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--r);
    padding: 1rem 1.25rem;
  }

  .tracker-label {
    font-size: 11px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 0.75rem;
  }

  .tracker-row {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 6px;
    min-height: 30px;
    margin-bottom: 0.75rem;
  }

  .t-step {
    font-size: 11px;
    padding: 3px 10px;
    border-radius: 20px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text-dim);
    transition: all 0.2s;
    white-space: nowrap;
  }

  .t-step.lit-bad {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }
  .t-step.lit-good {
    background: var(--good);
    border-color: var(--good);
    color: #fff;
  }
  .t-step.done {
    opacity: 0.4;
  }

  .t-arrow {
    font-size: 10px;
    color: #444;
  }

  .verdict {
    font-size: 12px;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    line-height: 1.5;
  }

  .verdict.bad {
    background: rgba(185, 74, 56, 0.07);
    border: 1px solid rgba(185, 74, 56, 0.2);
    color: var(--accent);
  }
  .verdict.good {
    background: rgba(44, 83, 100, 0.07);
    border: 1px solid rgba(44, 83, 100, 0.2);
    color: var(--good);
  }

  /* ── Code ── */
  .code {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--r);
    padding: 1rem 1.25rem;
    font-size: 12px;
    line-height: 1.8;
    overflow-x: auto;
    white-space: pre;
    margin-bottom: 1.5rem;
  }

  .c-comment {
    color: #9a9080;
  }
  .c-sel {
    color: #555047;
  }
  .c-prop {
    color: #2c5364;
  }
  .c-val {
    color: #8b3a3a;
  }
  .c-area {
    color: #7a5c1e;
  }
  .c-new {
    color: var(--good);
  }

  /* ── Order map ── */
  .map-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    border-radius: var(--r);
    overflow: hidden;
    margin-bottom: 1.5rem;
    font-size: 11px;
  }

  .map-grid .mh {
    background: var(--surface-2);
    padding: 6px 10px;
    color: var(--text-dim);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-size: 10px;
  }

  .map-grid .mc {
    background: var(--surface);
    padding: 8px 10px;
    color: var(--text);
  }

  .map-grid .mc span {
    display: inline-block;
    padding: 2px 7px;
    border-radius: 20px;
    font-size: 10px;
  }

  .t-dom {
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text-dim);
  }
  .t-vis {
    background: rgba(185, 74, 56, 0.1);
    border: 1px solid rgba(185, 74, 56, 0.25);
    color: var(--accent);
  }
  .t-fix {
    background: rgba(44, 83, 100, 0.1);
    border: 1px solid rgba(44, 83, 100, 0.25);
    color: var(--good);
  }

  /* ── Hint ── */
  .hint {
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 1rem;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  .hint-mobile {
    display: flex;
  }

  @media (hover: none) and (pointer: coarse) {
    .hint-mobile {
      display: flex;
    }
  }

  .play-btn {
    font-family: var(--mono);
    font-size: 12px;
    padding: 8px 16px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text);
    cursor: pointer;
    margin-top: 1rem;
    transition: background 0.15s;
    display: flex;
    align-items: center;
    gap: 8px;
    width: fit-content;
  }

  .play-btn:hover {
    background: var(--border);
  }
  .play-btn:active {
    transform: scale(0.98);
  }
  .play-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .cell.playing {
    outline: 2px solid var(--playing-color, var(--accent));
    outline-offset: -2px;
    box-shadow:
      inset 0 0 0 1px var(--playing-color, var(--accent)),
      0 4px 12px rgba(0, 0, 0, 0.12);
    transition:
      outline 0.2s,
      box-shadow 0.2s;
  }

  .play-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--playing-color, var(--accent));
    color: #fff;
    font-size: 11px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(0.5);
    transition:
      opacity 0.2s,
      transform 0.2s;
    z-index: 2;
    pointer-events: none;
  }

  .panel-good .play-badge {
    color: #000;
  }
  .cell.playing .play-badge {
    opacity: 1;
    transform: scale(1);
  }

  .key {
    display: inline-block;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-bottom: 2px solid var(--border);
    border-radius: 4px;
    padding: 1px 7px;
    font-size: 11px;
    color: var(--text);
  }

  /* ── Visual layout diagram ── */
  .layout-diagram {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 52px 52px;
    grid-template-areas: "cta feature" "art-a art-b";
    gap: 3px;
    margin-bottom: 1rem;
    font-size: 11px;
    max-width: 320px;
  }

  .ld-cell {
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 2px;
    font-size: 10px;
    letter-spacing: 0.05em;
  }

  .ld-cell .name {
    color: var(--text);
  }
  .ld-cell .pos {
    color: var(--text-dim);
    font-size: 9px;
  }

  .ld-cta {
    grid-area: cta;
    background: rgba(185, 74, 56, 0.08);
    border: 1px solid rgba(185, 74, 56, 0.2);
  }
  .ld-feature {
    grid-area: feature;
    background: var(--surface-2);
    border: 1px solid var(--border);
  }
  .ld-arta {
    grid-area: art-a;
    background: var(--surface-2);
    border: 1px solid var(--border);
  }
  .ld-artb {
    grid-area: art-b;
    background: var(--surface-2);
    border: 1px solid var(--border);
  }

  /* ── Footer ── */
  .footer {
    margin-top: 2.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
    font-size: 11px;
    color: var(--text-dim);
    line-height: 1.7;
  }

  .footer a {
    color: var(--text-dim);
  }
</style>
